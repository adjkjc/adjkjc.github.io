(window.webpackJsonp=window.webpackJsonp||[]).push([[324],{"./blocks/all-sites/all-sites-icon.scss":function(e,t,s){},"./blocks/all-sites/index.jsx":function(e,t,s){"use strict";var i=s("../node_modules/@babel/runtime/helpers/classCallCheck.js"),n=s.n(i),o=s("../node_modules/@babel/runtime/helpers/createClass.js"),r=s.n(o),a=s("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),l=s.n(a),c=s("../node_modules/@babel/runtime/helpers/inherits.js"),u=s.n(c),d=s("../node_modules/@babel/runtime/helpers/createSuper.js"),h=s.n(d),p=s("../node_modules/@babel/runtime/helpers/defineProperty.js"),m=s.n(p),f=s("../node_modules/prop-types/index.js"),g=s.n(f),v=s("../node_modules/react/index.js"),S=s.n(v),b=s("../node_modules/react-redux/es/index.js"),j=s("../packages/i18n-calypso/dist/esm/index.js"),y=s("../node_modules/lodash-es/noop.js"),_=s("../node_modules/classnames/index.js"),w=s.n(_),k=s("../node_modules/lodash-es/union.js"),x=s("./blocks/site-icon/index.jsx"),E=(s("./blocks/all-sites/all-sites-icon.scss"),function(e){u()(s,e);var t=h()(s);function s(){return n()(this,s),t.apply(this,arguments)}return r()(s,[{key:"getMaxSites",value:function(){return this.props.sites.slice(0,10)}},{key:"getSitesWithIcons",value:function(){return this.props.sites.filter((function(e){return e.icon})).slice(0,10)}},{key:"getIcons",value:function(){return Object(k.a)(this.getSitesWithIcons(),this.getMaxSites()).slice(0,10).map((function(e){return S.a.createElement(x.a,{site:e,key:e.ID,size:14})}))}},{key:"render",value:function(){var e=this.getIcons(),t="all-sites-icon has-".concat(this.getMaxSites().length,"-icons");return S.a.createElement("div",{className:t},e)}}]),s}(S.a.Component));m()(E,"propTypes",{sites:g.a.array.isRequired});var O=s("./config/index.js"),M=s("./components/count/index.jsx"),C=s("./state/selectors/get-sites.js"),I=s("./state/current-user/selectors.js"),N=(s("./blocks/all-sites/style.scss"),function(e){u()(s,e);var t=h()(s);function s(){var e;n()(this,s);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o)),m()(l()(e),"onSelect",(function(t){e.props.onSelect(t)})),e}return r()(s,[{key:"renderSiteCount",value:function(){return S.a.createElement(M.a,{count:this.props.count})}},{key:"render",value:function(){var e=this.props,t=e.title,s=e.href,i=e.domain,n=e.sites,o=e.translate,r=e.isHighlighted,a=e.isSelected,l=e.showCount,c=w()({"all-sites":!0,"is-selected":a,"is-highlighted":r});return S.a.createElement("div",{className:c},S.a.createElement("a",{className:"all-sites__content site__content",href:s,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.onSelect},l&&this.renderSiteCount(),S.a.createElement("div",{className:"all-sites__info site__info"},S.a.createElement("span",{className:"all-sites__title site__title"},t||o("All My Sites")),i&&S.a.createElement("span",{className:"all-sites__domain site__domain"},i),S.a.createElement(E,{sites:n}))))}}]),s}(v.Component));m()(N,"defaultProps",{onSelect:y.a,href:null,isSelected:!1,isHighlighted:!1,showCount:!0,domain:""}),m()(N,"propTypes",{onSelect:g.a.func,href:g.a.string,isSelected:g.a.bool,isHighlighted:g.a.bool,showCount:g.a.bool,count:g.a.number,title:g.a.string,domain:g.a.string,onMouseEnter:g.a.func,onMouseLeave:g.a.func});var A=function(e){var t=e.visible;return void 0===t||t};t.a=Object(b.c)((function(e,t){var s=t.sites,i=void 0===s?Object(C.a)(e):s,n=t.userSitesCount,o=void 0===n?Object(I.l)(e):n,r=null==i?void 0:i.filter(A);return{sites:O.a.isEnabled("realtime-site-count")?r:i,count:O.a.isEnabled("realtime-site-count")?r.length:o}}))(Object(j.c)(N))},"./blocks/all-sites/style.scss":function(e,t,s){},"./components/site-selector/index.jsx":function(e,t,s){"use strict";var i=s("../node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js"),n=s.n(i),o=s("../node_modules/@babel/runtime/helpers/classCallCheck.js"),r=s.n(o),a=s("../node_modules/@babel/runtime/helpers/createClass.js"),l=s.n(a),c=s("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=s.n(c),d=s("../node_modules/@babel/runtime/helpers/inherits.js"),h=s.n(d),p=s("../node_modules/@babel/runtime/helpers/createSuper.js"),m=s.n(p),f=s("../node_modules/@babel/runtime/helpers/defineProperty.js"),g=s.n(f),v=s("../node_modules/react/index.js"),S=s.n(v),b=s("../node_modules/prop-types/index.js"),j=s.n(b),y=s("../node_modules/react-dom/index.js"),_=s.n(y),w=s("../node_modules/react-redux/es/index.js"),k=s("../packages/i18n-calypso/dist/esm/index.js"),x=s("../node_modules/page/page.js"),E=s.n(x),O=s("../node_modules/classnames/index.js"),M=s.n(O),C=s("../node_modules/lodash-es/find.js"),I=s("../node_modules/lodash-es/isEmpty.js"),N=s("../node_modules/lodash-es/filter.js"),A=s("../node_modules/lodash-es/includes.js"),H=s("../node_modules/lodash-es/noop.js"),R=s("../node_modules/lodash-es/get.js"),T=s("../node_modules/lodash-es/flow.js"),L=s("../node_modules/debug/src/browser.js"),D=s.n(L),P=s("./state/preferences/selectors.js"),K=s("./state/current-user/selectors.js"),F=s("./state/ui/selectors/get-selected-site.js"),U=s("./state/sites/selectors/get-site.js"),B=s("./state/sites/selectors/has-all-sites-list.js"),Y=s("./state/selectors/are-all-sites-single-user.js"),V=s("./state/selectors/get-sites.js"),X=s("./state/selectors/get-visible-sites.js"),q=s("./state/selectors/has-loaded-sites.js"),z=s("./blocks/all-sites/index.jsx"),W=s("./blocks/site/index.jsx"),G=s("./blocks/site/placeholder.jsx"),J=s("./components/search/index.jsx"),$=s("./components/gridicon/index.tsx"),Q=s("../packages/components/dist/esm/button/index.js"),Z=s("./state/analytics/actions/record.js"),ee=function(e){h()(s,e);var t=m()(s);function s(){var e;r()(this,s);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n)),g()(u()(e),"recordAddNewSite",(function(){e.props.recordTracksEvent("calypso_add_new_wordpress_click")})),e}return l()(s,[{key:"getAddNewSiteUrl",value:function(){return"/jetpack/new/?ref=calypso-selector"}},{key:"render",value:function(){var e=this.props.translate;return S.a.createElement("span",{className:"site-selector__add-new-site"},S.a.createElement(Q.a,{borderless:!0,href:this.getAddNewSiteUrl(),onClick:this.recordAddNewSite},S.a.createElement($.a,{icon:"add-outline"})," ",e("Add new site")))}}]),s}(v.Component),te=Object(w.c)(null,{recordTracksEvent:Z.e})(Object(k.c)(ee)),se=s("../node_modules/@babel/runtime/helpers/extends.js"),ie=s.n(se),ne=function(e,t,s){return e.filter((function(e){return function(e,t,s){return s.some((function(s){return Object(R.a)(e,s,"").toLowerCase().indexOf(t)>-1}))}(e,t,s)}))},oe=function(e){return{sites:Object(V.a)(e)}};var re=s("./lib/scroll-into-viewport/index.js"),ae=(s("./components/site-selector/style.scss"),"ALL_SITES"),le=D()("calypso:site-selector"),ce=function(e){h()(s,e);var t=m()(s);function s(){var e;r()(this,s);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n)),g()(u()(e),"state",{highlightedIndex:-1,showSearch:!1,isKeyboardEngaged:!1}),g()(u()(e),"onSearch",(function(t){e.props.searchSites(t),e.setState({highlightedIndex:t?0:-1,showSearch:!!t||e.state.showSearch,isKeyboardEngaged:!0})})),g()(u()(e),"onKeyDown",(function(t){var s=e.visibleSites.length;if(0!==s&&!t.shiftKey){var i=e.computeHighlightedSite(),n=i.highlightedSiteId,o=i.highlightedIndex,r=null;switch(t.key){case"ArrowUp":(r=o-1)<0&&(r=s-1);break;case"ArrowDown":(r=o+1)>=s&&(r=0);break;case"Enter":n&&(n===ae?e.onSiteSelect(t,ae):e.onSiteSelect(t,n))}null!==r&&(e.lastMouseHover=null,e.setState({highlightedIndex:r,isKeyboardEngaged:!0}))}})),g()(u()(e),"onSiteSelect",(function(t,s){var i=e.props.onSiteSelect(s);if(e.props.onClose(t,s),e.siteSelectorRef){var n=_.a.findDOMNode(e.siteSelectorRef);n&&(n.scrollTop=0),i||e.props.navigateToSite(s,e.props)}})),g()(u()(e),"onAllSitesSelect",(function(t){e.onSiteSelect(t,ae)})),g()(u()(e),"onSiteHover",(function(t,s){e.lastMouseHover!==s&&(le("".concat(s," hovered")),e.lastMouseHover=s)})),g()(u()(e),"onAllSitesHover",(function(){e.lastMouseHover!==ae&&(le("ALL_SITES hovered"),e.lastMouseHover=ae)})),g()(u()(e),"onMouseLeave",(function(){le("mouse left site selector - nothing hovered anymore"),e.lastMouseHover=null})),g()(u()(e),"onMouseMove",(function(t){t.pageX===e.lastMouseMoveX&&t.pageY===e.lastMouseMoveY||(e.lastMouseMoveY=t.pageY,e.lastMouseMoveX=t.pageX,e.state.isKeyboardEngaged&&e.setState({isKeyboardEngaged:!1}))})),g()(u()(e),"setSiteSelectorRef",(function(t){return e.siteSelectorRef=t})),e}return l()(s,[{key:"componentDidUpdate",value:function(e,t){this.state.isKeyboardEngaged&&t.highlightedIndex!==this.state.highlightedIndex&&this.scrollToHighlightedSite()}},{key:"scrollToHighlightedSite",value:function(){if(this.siteSelectorRef){var e=_.a.findDOMNode(this.siteSelectorRef);if(e){var t=e.querySelector(".site.is-highlighted, .site-selector .all-sites.is-highlighted");t&&Object(re.a)(t,{block:"nearest",scrollMode:"if-needed"})}}}},{key:"computeHighlightedSite",value:function(){var e,t;return this.state.isKeyboardEngaged?(le("using highlight from last keyboard interaction"),e=this.visibleSites[this.state.highlightedIndex],t=this.state.highlightedIndex):this.lastMouseHover?(le("restoring highlight from last mouse hover (".concat(this.lastMouseHover,")")),e=this.props.highlightedSiteId||this.lastMouseHover,t=this.visibleSites.indexOf(e)):(le("resetting highlight as mouse left site selector"),e=null,t=-1),{highlightedSiteId:e,highlightedIndex:t}}},{key:"isSelected",value:function(e){var t=this.props.selected||this.props.selectedSite;return e===ae&&null===t||t===e.ID||t===e.domain||t===e.slug}},{key:"isHighlighted",value:function(e){return this.state.isKeyboardEngaged&&this.visibleSites.indexOf(e)===this.state.highlightedIndex}},{key:"shouldShowGroups",value:function(){return this.props.groups}},{key:"sitesToBeRendered",value:function(){var e,t=this;return e=this.props.sitesFound?this.props.sitesFound:this.props.visibleSites,this.props.filter&&(e=e.filter(this.props.filter)),this.props.hideSelected&&this.props.selected&&(e=e.filter((function(e){return e.slug!==t.props.selected}))),e}},{key:"shouldRenderRecentSites",value:function(){return this.props.showRecentSites&&this.shouldShowGroups()&&!this.props.sitesFound}},{key:"renderAllSites",value:function(){if(!this.props.showAllSites||this.props.sitesFound||!this.props.allSitesPath)return null;this.visibleSites.push(ae);var e=this.isHighlighted(ae);return S.a.createElement(z.a,{key:"selector-all-sites",sites:this.props.sites,onSelect:this.onAllSitesSelect,onMouseEnter:this.onAllSitesHover,isHighlighted:e,isSelected:this.isSelected(ae)})}},{key:"renderRecentSites",value:function(e){if(!this.shouldRenderRecentSites())return null;var t,s=[],i=n()(this.props.recentSites);try{for(i.s();!(t=i.n()).done;){var o=t.value,r=Object(C.a)(e,{ID:o});r&&s.push(r)}}catch(e){i.e(e)}finally{i.f()}if(Object(I.a)(s))return null;var a=s.map(this.renderSite,this);return S.a.createElement("div",{className:"site-selector__recent"},a)}},{key:"renderSites",value:function(e){if(!this.props.hasAllSitesList)return S.a.createElement(G.a,{key:"site-placeholder"});if(this.shouldRenderRecentSites()){var t=this.props.recentSites;e=Object(N.a)(e,(function(e){var s=e.ID;return!Object(A.a)(t,s)}))}var s=e.map(this.renderSite,this);return s.length?s:S.a.createElement("div",{className:"site-selector__no-results"},this.props.translate("No sites found"))}},{key:"renderSite",value:function(e){if(!e)return null;this.visibleSites.push(e.ID);var t=this.isHighlighted(e.ID);return S.a.createElement(W.a,{site:e,key:"site-"+e.ID,indicator:this.props.indicator,onSelect:this.onSiteSelect,onMouseEnter:this.onSiteHover,isHighlighted:t,isSelected:this.isSelected(e)})}},{key:"render",value:function(){if(this.props.isPlaceholder)return S.a.createElement("div",{className:"site-selector"});var e=this.props.siteCount-this.props.visibleSiteCount,t=M()("site-selector","sites-list",this.props.className,{"is-large":this.props.siteCount>6||e>0||this.state.showSearch,"is-single":1===this.props.visibleSiteCount,"is-hover-enabled":!this.state.isKeyboardEngaged});this.visibleSites=[];var s=this.sitesToBeRendered();return S.a.createElement("div",{className:t,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},S.a.createElement(J.a,{onSearch:this.onSearch,delaySearch:!0,autoFocus:this.props.autoFocus,disabled:!this.props.hasLoadedSites,onSearchClose:this.props.onClose,onKeyDown:this.onKeyDown}),S.a.createElement("div",{className:"site-selector__sites",ref:this.setSiteSelectorRef},this.renderAllSites(),this.renderRecentSites(s),this.renderSites(s),e>0&&!this.props.sitesFound&&S.a.createElement("span",{className:"site-selector__hidden-sites-message"},this.props.translate("%(hiddenSitesCount)d more hidden site. {{a}}Change{{/a}}.{{br/}}Use search to access it.","%(hiddenSitesCount)d more hidden sites. {{a}}Change{{/a}}.{{br/}}Use search to access them.",{count:e,args:{hiddenSitesCount:e},components:{br:S.a.createElement("br",null),a:S.a.createElement("a",{href:"https://dashboard.wordpress.com/wp-admin/index.php?page=my-blogs&show=hidden",className:"site-selector__manage-hidden-sites",target:"_blank",rel:"noopener noreferrer"})}}))),this.props.showAddNewSite&&S.a.createElement(te,null))}}]),s}(v.Component);g()(ce,"propTypes",{isPlaceholder:j.a.bool,sites:j.a.array,siteBasePath:j.a.oneOfType([j.a.string,j.a.bool]),showAddNewSite:j.a.bool,showAllSites:j.a.bool,indicator:j.a.bool,autoFocus:j.a.bool,onClose:j.a.func,selected:j.a.oneOfType([j.a.number,j.a.string]),hideSelected:j.a.bool,filter:j.a.func,groups:j.a.bool,onSiteSelect:j.a.func,showRecentSites:j.a.bool,recentSites:j.a.array,selectedSite:j.a.object,visibleSites:j.a.arrayOf(j.a.object),allSitesPath:j.a.string,navigateToSite:j.a.func.isRequired}),g()(ce,"defaultProps",{sites:{},showAddNewSite:!1,showAllSites:!1,siteBasePath:!1,indicator:!1,hideSelected:!1,selected:null,onClose:H.a,onSiteSelect:H.a,groups:!1,autoFocus:!1});t.a=Object(T.a)(k.c,(function(e){var t=e.displayName||e.name||"",s=function(t){h()(i,t);var s=m()(i);function i(){var e;r()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=s.call.apply(s,[this].concat(n)),g()(u()(e),"state",{term:null}),g()(u()(e),"setSearchTerm",(function(t){return e.setState({term:t})})),e}return l()(i,[{key:"getSearchResults",value:function(){return this.state.term?ne(this.props.sites,this.state.term.toLowerCase(),["name","URL"]):null}},{key:"render",value:function(){return S.a.createElement(e,ie()({},this.props,{searchSites:this.setSearchTerm,sitesFound:this.getSearchResults()}))}}]),i}(v.Component),i=Object(w.c)(oe)(s);return i.displayName="SearchSites(".concat(t,")"),i}),Object(w.c)((function(e){var t=Object(K.b)(e),s=Object(R.a)(t,"visible_site_count",0);return{hasLoadedSites:Object(q.a)(e),sites:Object(V.a)(e),showRecentSites:Object(R.a)(t,"visible_site_count",0)>11,recentSites:Object(P.b)(e,"recentSites"),siteCount:Object(R.a)(t,"site_count",0),visibleSiteCount:s,selectedSite:Object(F.a)(e),visibleSites:Object(X.a)(e),allSitesSingleUser:Object(Y.a)(e),hasAllSitesList:Object(B.a)(e)}}),{navigateToSite:function(e,t){var s=t.allSitesPath,i=t.allSitesSingleUser,n=t.siteBasePath;return function(t,o){var r=o(),a=function(){var t=Object(U.a)(r,e);if(le("getPathnameForSite",e,t),e===ae){var o=i?"/posts":"/posts/my";return s.replace(/^\/posts\b(\/my)?/,o).replace(/^\/stats\/insights\/?$/,"/stats/day")}if(n)return function(e){var t=n,s=e.jetpack||e.single_user_site?"/posts":"/posts/my";(t=t.replace(/^\/posts\b(\/my)?/,s)).match(/^\/stats\/(post|page)\//)&&(t="/stats");t.match(/^\/domains\/manage\//)&&(t="/domains/manage");t.match(/^\/email\//)&&(t="/email");if(t.match(/^\/store\/stats\//)){e.jetpack&&e.options&&e.options.woocommerce_is_active||(t="/stats/day")}t.match(/^\/backups\/.*\/(download|restore|detail)/)&&(t="/backups");return t}(t)+"/"+t.slug}();a&&E()(a)}}}))(ce)},"./components/site-selector/style.scss":function(e,t,s){},"./lib/scroll-into-viewport/index.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),n=s.n(i),o="undefined"!=typeof document&&document.documentElement&&"scrollBehavior"in document.documentElement.style;function r(e,t,s){var i,n,o,r,a=function e(t,s,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return n+=t[s],t[i]?e(t[i],s,i,n):n}(e,"offsetTop","offsetParent"),l=a+e.offsetHeight;if(i=a,n=l,o=window.scrollY,r=document.documentElement.clientHeight+window.scrollY,!(i>o&&n<r&&"if-needed"===s))try{window.scroll({top:a,left:0,behavior:t})}catch(e){window.scrollTo(0,a)}}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.behavior,i=void 0===s?"auto":s,a=t.block,l=void 0===a?"start":a,c=t.scrollMode,u=void 0===c?"always":c,d=n()(t,["behavior","block","scrollMode"]);if(e)if(!e.scrollIntoViewIfNeeded||"auto"!==i&&o||"center"!==l&&"nearest"!==l||"if-needed"!==u||void 0!==d){if(e.scrollIntoView)try{return void e.scrollIntoView(t)}catch(e){}r(e,i,u)}else e.scrollIntoViewIfNeeded("center"===l)}},"./state/selectors/are-all-sites-single-user.js":function(e,t,s){"use strict";var i=s("./lib/create-selector/index.js"),n=s("./state/selectors/get-sites-items.js"),o=s("./state/sites/selectors/is-single-user-site.js");t.a=Object(i.a)((function(e){var t=Object.keys(Object(n.a)(e));return!!t.length&&t.every((function(t){return Object(o.a)(e,t)}))}),n.a)},"./state/selectors/get-visible-sites.js":function(e,t,s){"use strict";var i=s("./state/sites/selectors/get-site.js"),n=s("./state/selectors/get-sites-items.js"),o=s("./lib/create-selector/index.js");t.a=Object(o.a)((function(e){return Object.values(Object(n.a)(e)).filter((function(e){return!0===e.visible})).map((function(t){return Object(i.a)(e,t.ID)}))}),(function(e){return[Object(n.a)(e)]}))},"./state/selectors/has-loaded-sites.js":function(e,t,s){"use strict";function i(e){return null!==e.sites.items}s.d(t,"a",(function(){return i}))},"./state/sites/selectors/is-single-user-site.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("../node_modules/lodash-es/get.js"),n=s("./state/sites/selectors/get-site.js");function o(e,t){return Object(i.a)(Object(n.a)(e,t),"single_user_site",null)}}}]);